Enter password: *********
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 23
Server version: 8.0.31 MySQL Community Server - GPL

Copyright (c) 2000, 2022, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> SHOW databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| sakila             |
| sys                |
| test               |
| test_1             |
| world              |
+--------------------+
8 rows in set (0.00 sec)

mysql> USE test_1;
Database changed
mysql> SHOW TABLES;
Empty set (0.01 sec)

mysql> CREATE TABLE fine
    -> (
    -> fine_id INT PRIMARY KEY AUTO_INCREMENT,
    -> name VARCHAR(30),
    -> number_plate VARCHAR(6),
    -> violation VARCHAR(50),
    -> sum_fine DECIMAL(8,2),
    -> date_violation DATE,
    -> date_payment DATE);
Query OK, 0 rows affected (0.02 sec)

mysql> SHOW tables;
+------------------+
| Tables_in_test_1 |
+------------------+
| fine             |
+------------------+
1 row in set (0.00 sec)

mysql> DESC fine;
+----------------+--------------+------+-----+---------+----------------+
| Field          | Type         | Null | Key | Default | Extra          |
+----------------+--------------+------+-----+---------+----------------+
| fine_id        | int          | NO   | PRI | NULL    | auto_increment |
| name           | varchar(30)  | YES  |     | NULL    |                |
| number_plate   | varchar(6)   | YES  |     | NULL    |                |
| violation      | varchar(50)  | YES  |     | NULL    |                |
| sum_fine       | decimal(8,2) | YES  |     | NULL    |                |
| date_violation | date         | YES  |     | NULL    |                |
| date_payment   | date         | YES  |     | NULL    |                |
+----------------+--------------+------+-----+---------+----------------+
7 rows in set (0.00 sec)

mysql> INSERT INTO fine (name, number_plate, violation, sum_fine, date_violation, date_payment)
    -> VALUES
    -> ('Баранов П.Е.', 'Р523ВТ', 'Превышение скорости(от 40 до 60)', 500.00, '2020-01-12', '2020-01-17'),
    -> ('Баранов П.Е.', 'Р523ВТ', 'Превышение скорости(от 40 до 60)', null, '2020-02-14', null),
    -> ('Абрамова К.А.', 'О111АВ', 'Проезд на запрещающий сигнал', null, '2020-02-23', null),
    -> ('Яковлев Г.Р.', 'Т330ТТ', 'Проезд на запрещающий сигнал', null, '2020-03-03', null),
	-> ('Абрамова К.А.', 'О111АВ', 'Проезд на запрещающий сигнал', 1000.00, '2020-01-14', '2020-02-27'),
    -> ('Яковлев Г.Р.', 'Т330ТТ', 'Превышение скорости(от 20 до 40)', 500.00, '2020-01-23', '2020-02-23'),
    -> ('Яковлев Г.Р.', 'М701АА', 'Превышение скорости(от 20 до 40)', NULL, '2020-01-12', NULL),
    -> ('Колесов С.П.', 'К892АХ', 'Превышение скорости(от 20 до 40)', NULL, '2020-02-01', NULL);
Query OK, 8 rows affected (0.00 sec)
Records: 8  Duplicates: 0  Warnings: 0

mysql> SELECT * FROM fine;
+---------+---------------+--------------+----------------------------------+----------+----------------+--------------+
| fine_id | name          | number_plate | violation                        | sum_fine | date_violation | date_payment |
+---------+---------------+--------------+----------------------------------+----------+----------------+--------------+
|       1 | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) |   500.00 | 2020-01-12     | 2020-01-17   |
|       2 | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) |     NULL | 2020-02-14     | NULL         |
|       3 | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     |     NULL | 2020-02-23     | NULL         |
|       4 | Яковлев Г.Р.  | Т330ТТ       | Проезд на запрещающий сигнал     |     NULL | 2020-03-03     | NULL         |
|       5 | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     |  1000.00 | 2020-01-14     | 2020-02-27   |
|       6 | Яковлев Г.Р.  | Т330ТТ       | Превышение скорости(от 20до 40)  |   500.00 | 2020-01-23     | 2020-02-23   |
|       7 | Яковлев Г.Р.  | М701АА       | Превышение скорости(от 20до 40)  |     NULL | 2020-01-12     | NULL         |
|       8 | Колесов С.П.  | К892АХ       | Превышение скорости(от 20до 40)  |     NULL | 2020-02-01     | NULL         |
+---------+---------------+--------------+----------------------------------+----------+----------------+--------------+
8 rows in set (0.00 sec)

mysql> CREATE TABLE traffic_violation
    -> (
    -> violation_id INT PRIMARY KEY AUTO_INCREMENT,
    -> violation VARCHAR(50),
    -> sum_fine DECIMAL(8,2)
    -> );
Query OK, 0 rows affected (0.02 sec)

mysql> INSERT INTO traffic_violation (violation, sum_fine)
    -> VALUES
    -> ('Превышение скорости(от 20до 40)', 500.00),
    -> ('Превышение скорости(от 40 до 60)', 1000.00),
    -> ('Проезд на запрещающий сигнал', 1000.00);
Query OK, 3 rows affected (0.01 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql> SELECT*FROM traffic_violation;
+--------------+----------------------------------+----------+
| violation_id | violation                        | sum_fine |
+--------------+----------------------------------+----------+
|            1 | Превышение скорости(от 20до 40)  |   500.00 |
|            2 | Превышение скорости(от 40 до 60) |  1000.00 |
|            3 | Проезд на запрещающий сигнал     |  1000.00 |
+--------------+----------------------------------+----------+
3 rows in set (0.00 sec)

Задание: Занести в таблицу fine суммы штрафов, которые должен оплатить водитель, 
в соответствии с данными из таблицы traffic_violation. 
При этом суммы заносить только в пустые поля столбца sum_fine.

mysql> UPDATE fine, traffic_violation
    -> SET fine.sum_fine = traffic_violation.sum_fine
    -> WHERE fine.violation = traffic_violation.violation AND fine.sum_fine IS NULL;
Query OK, 5 rows affected (0.00 sec)
Rows matched: 5  Changed: 5  Warnings: 0

mysql>
mysql> SELECT * FROM fine;
+---------+---------------+--------------+----------------------------------+----------+----------------+--------------+
| fine_id | name          | number_plate | violation                        | sum_fine | date_violation | date_payment |
+---------+---------------+--------------+----------------------------------+----------+----------------+--------------+
|       1 | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) |   500.00 | 2020-01-12     | 2020-01-17   |
|       2 | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) |  1000.00 | 2020-02-14     | NULL         |
|       3 | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     |  1000.00 | 2020-02-23     | NULL         |
|       4 | Яковлев Г.Р.  | Т330ТТ       | Проезд на запрещающий сигнал     |  1000.00 | 2020-03-03     | NULL         |
|       5 | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     |  1000.00 | 2020-01-14     | 2020-02-27   |
|       6 | Яковлев Г.Р.  | Т330ТТ       | Превышение скорости(от 20до 40)  |   500.00 | 2020-01-23     | 2020-02-23   |
|       7 | Яковлев Г.Р.  | М701АА       | Превышение скорости(от 20до 40)  |   500.00 | 2020-01-12     | NULL         |
|       8 | Колесов С.П.  | К892АХ       | Превышение скорости(от 20до 40)  |   500.00 | 2020-02-01     | NULL         |
+---------+---------------+--------------+----------------------------------+----------+----------------+--------------+
8 rows in set (0.00 sec)

Задание: Вывести фамилию, номер машины и нарушение только для тех водителей, 
которые на одной машине нарушили одно и то же правило   два и более раз. 
При этом учитывать все нарушения, независимо от того оплачены они или нет. 
Информацию отсортировать в алфавитном порядке, сначала по фамилии водителя, 
потом по номеру машины и, наконец, по нарушению.

mysql> SELECT name, number_plate, violation
    -> FROM fine
    -> GROUP BY 1, 2, 3
    -> HAVING COUNT(3)>=2
    -> ORDER BY 1, 2, 3 DESC;
+---------------+--------------+----------------------------------+
| name          | number_plate | violation                        |
+---------------+--------------+----------------------------------+
| Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     |
| Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) |
+---------------+--------------+----------------------------------+
2 rows in set (0.00 sec)

Задние: В таблице fine увеличить в два раза сумму неоплаченных штрафов для отобранных на предыдущем шаге записей.

mysql> UPDATE fine,(
    ->     SELECT name, number_plate, violation
    ->     FROM fine
    ->     GROUP BY  1, 2, 3
    ->     HAVING COUNT(3)>=2
    ->     ORDER BY 1,2,3) as new
    -> SET sum_fine = IF(date_payment is NULL,sum_fine*2,sum_fine)
    -> WHERE fine.name = new.name;
Query OK, 2 rows affected (0.00 sec)
Rows matched: 4  Changed: 2  Warnings: 0

mysql> select * from fine;
+---------+---------------+--------------+----------------------------------+----------+----------------+--------------+
| fine_id | name          | number_plate | violation                        | sum_fine | date_violation | date_payment |
+---------+---------------+--------------+----------------------------------+----------+----------------+--------------+
|       1 | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) |   500.00 | 2020-01-12     | 2020-01-17   |
|       2 | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) |  2000.00 | 2020-02-14     | NULL         |
|       3 | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     |  2000.00 | 2020-02-23     | NULL         |
|       4 | Яковлев Г.Р.  | Т330ТТ       | Проезд на запрещающий сигнал     |  1000.00 | 2020-03-03     | NULL         |
|       5 | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     |  1000.00 | 2020-01-14     | 2020-02-27   |
|       6 | Яковлев Г.Р.  | Т330ТТ       | Превышение скорости(от 20до 40)  |   500.00 | 2020-01-23     | 2020-02-23   |
|       7 | Яковлев Г.Р.  | М701АА       | Превышение скорости(от 20до 40)  |   500.00 | 2020-01-12     | NULL         |
|       8 | Колесов С.П.  | К892АХ       | Превышение скорости(от 20до 40)  |   500.00 | 2020-02-01     | NULL         |
+---------+---------------+--------------+----------------------------------+----------+----------------+--------------+
8 rows in set (0.00 sec)

Задание: Создать новую таблицу back_payment, куда внести информацию о неоплаченных штрафах 
(Фамилию и инициалы водителя, номер машины, нарушение, сумму штрафа  и  дату нарушения) из таблицы fine.

mysql> CREATE TABLE back_payment AS
    -> SELECT name, number_plate, violation, sum_fine, date_violation
    -> FROM fine
    -> WHERE date_payment IS NULL;
Query OK, 5 rows affected (0.03 sec)
Records: 5  Duplicates: 0  Warnings: 0

mysql> SELECT * FROM back_payment;
+---------------+--------------+----------------------------------+----------+----------------+
| name          | number_plate | violation                        | sum_fine | date_violation |
+---------------+--------------+----------------------------------+----------+----------------+
| Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) |  2000.00 | 2020-02-14     |
| Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     |  2000.00 | 2020-02-23     |
| Яковлев Г.Р.  | Т330ТТ       | Проезд на запрещающий сигнал     |  1000.00 | 2020-03-03     |
| Яковлев Г.Р.  | М701АА       | Превышение скорости(от 20до 40)  |   500.00 | 2020-01-12     |
| Колесов С.П.  | К892АХ       | Превышение скорости(от 20до 40)  |   500.00 | 2020-02-01     |
+---------------+--------------+----------------------------------+----------+----------------+
5 rows in set (0.00 sec)

Задание: Удалить из таблицы fine информацию о нарушениях, совершенных раньше 1 февраля 2020 года. 

mysql> DELETE FROM fine
    -> WHERE date_violation < DATE(20200201) AND date_payment IS NOT NULL;
Query OK, 3 rows affected (0.00 sec)

mysql> SELECT * FROM fine;
+---------+---------------+--------------+----------------------------------+----------+----------------+--------------+
| fine_id | name          | number_plate | violation                        | sum_fine | date_violation | date_payment |
+---------+---------------+--------------+----------------------------------+----------+----------------+--------------+
|       2 | Баранов П.Е.  | Р523ВТ       | Превышение скорости(от 40 до 60) |  2000.00 | 2020-02-14     | NULL         |
|       3 | Абрамова К.А. | О111АВ       | Проезд на запрещающий сигнал     |  2000.00 | 2020-02-23     | NULL         |
|       4 | Яковлев Г.Р.  | Т330ТТ       | Проезд на запрещающий сигнал     |  1000.00 | 2020-03-03     | NULL         |
|       7 | Яковлев Г.Р.  | М701АА       | Превышение скорости(от 20до 40)  |   500.00 | 2020-01-12     | NULL         |
|       8 | Колесов С.П.  | К892АХ       | Превышение скорости(от 20до 40)  |   500.00 | 2020-02-01     | NULL         |
+---------+---------------+--------------+----------------------------------+----------+----------------+--------------+
5 rows in set (0.00 sec)
